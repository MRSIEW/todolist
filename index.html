<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>待办事项清单与日期倒计时</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 25px;
            background-color: #d1e7dd; /* 温暖的浅绿色背景 */
        }
        .task, .countdown-task {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        .task.completed {
            text-decoration: line-through;
        }
        .task input[type="checkbox"] {
            margin-right: 10px;
        }
        .countdown {
            color: red;
        }
        .error {
            color: red;
        }
        .remove-btn {
            margin-left: 10px;
            cursor: pointer;
            color: red;
        }
        .clock {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }
        .time, .date, .temperature {
            margin-right: 20px;
        }
    </style>
</head>
<body>
    <div class="clock">
        <div class="time" id="time"></div>
        <div class="date" id="date"></div>
        <div class="temperature" id="temperature"></div>
    </div>

    <h1>待办事项清单</h1>
    <div id="taskList"></div>
    <input type="text" id="newTask" placeholder="输入新任务">
    <button onclick="addTask()">添加任务</button>

    <h2>日期倒计时</h2>
    <div id="countdownList"></div>
    <input type="date" id="targetDate">
    <input type="text" id="countdownDescription" placeholder="输入倒数描述">
    <button onclick="addCountdown()">添加倒计时</button>
    <div id="error" class="error"></div>

    <script>
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('time').textContent = `时间: ${hours}:${minutes}:${seconds}`;
        }

        function updateDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            document.getElementById('date').textContent = `日期: ${year}-${month}-${day}`;
        }

        async function updateTemperature() {
            try {
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=35.6895&longitude=139.6917&current_weather=true&hourly=temperature_2m');
                const data = await response.json();
                const temperature = data.current_weather.temperature;
                document.getElementById('temperature').textContent = `温度: ${temperature}°C`;
            } catch (error) {
                document.getElementById('temperature').textContent = '无法获取温度';
            }
        }

        function addTask() {
            const taskText = document.getElementById('newTask').value;
            if (taskText === '') return;

            const taskList = document.getElementById('taskList');

            const taskDiv = document.createElement('div');
            taskDiv.className = 'task';

            const taskSpan = document.createElement('span');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.onchange = function () {
                if (this.checked) {
                    taskDiv.classList.add('completed');
                } else {
                    taskDiv.classList.remove('completed');
                }
            };

            const removeBtn = document.createElement('span');
            removeBtn.textContent = '删除';
            removeBtn.className = 'remove-btn';
            removeBtn.onclick = function () {
                taskList.removeChild(taskDiv);
            };

            taskSpan.appendChild(checkbox);
            taskSpan.appendChild(document.createTextNode(taskText));

            taskDiv.appendChild(taskSpan);
            taskDiv.appendChild(removeBtn);
            taskList.appendChild(taskDiv);

            document.getElementById('newTask').value = '';
        }

        function addCountdown() {
            const targetDate = new Date(document.getElementById('targetDate').value);
            const countdownDescription = document.getElementById('countdownDescription').value;
            const errorDiv = document.getElementById('error');

            if (!targetDate || isNaN(targetDate.getTime()) || countdownDescription === '') {
                errorDiv.textContent = '请确保输入有效的日期和描述。';
                return;
            }

            errorDiv.textContent = '';

            const countdownList = document.getElementById('countdownList');

            const countdownDiv = document.createElement('div');
            countdownDiv.className = 'countdown-task';

            const countdownSpan = document.createElement('span');
            countdownSpan.textContent = countdownDescription;

            const countdownTime = document.createElement('div');
            countdownTime.className = 'countdown';

            const removeBtn = document.createElement('span');
            removeBtn.textContent = '删除';
            removeBtn.className = 'remove-btn';
            removeBtn.onclick = function () {
                countdownList.removeChild(countdownDiv);
            };

            countdownDiv.appendChild(countdownSpan);
            countdownDiv.appendChild(countdownTime);
            countdownDiv.appendChild(removeBtn);
            countdownList.appendChild(countdownDiv);

            function updateCountdown() {
                const now = new Date();
                const timeDifference = targetDate - now;
                if (timeDifference <= 0) {
                    countdownTime.textContent = '倒计时结束';
                    return;
                }

                const days = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeDifference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);

                countdownTime.textContent = `剩余时间：${days}天 ${hours}小时 ${minutes}分钟 ${seconds}秒`;

                setTimeout(updateCountdown, 1000);
            }

            updateCountdown();
        }

        setInterval(updateTime, 1000);
        updateTime();

        setInterval(updateDate, 1000);
        updateDate();

        updateTemperature();
        setInterval(updateTemperature, 60000); // 每分钟更新一次温度
    </script>
</body>
</html>
